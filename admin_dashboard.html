{% extends "base.html" %}
{% block title %}Admin Dashboard{% endblock %}
{% block content %}

<section class="min-h-screen bg-gradient-to-b from-[#0b0b0b] via-[#121212] to-[#1a1a1a] text-white py-16 px-6">
  <div class="max-w-6xl mx-auto">
    <h2 class="text-4xl md:text-5xl font-extrabold text-brand text-center mb-12">Admin Dashboard</h2>

    <!-- Upload form -->
    <form id="uploadForm" 
          action="{{ url_for('admin_dashboard') }}" 
          method="POST" 
          enctype="multipart/form-data"
          class="bg-[#111111] border border-white/10 rounded-2xl p-8 shadow-xl mb-12">

      <div class="grid grid-cols-1 md:grid-cols-2 gap-6 text-left">

        <!-- Page Selector -->
        <div>
          <label for="page_name" class="block text-sm font-semibold mb-2 text-gray-300">Select Page</label>
          <select id="page_name" name="page_name" 
                  class="w-full bg-[#1c1c1c] text-white border border-white/10 rounded-lg p-3 focus:ring-2 focus:ring-brand/60">
            <option value="home" {% if selected_page == 'home' %}selected{% endif %}>Home</option>
            <option value="about" {% if selected_page == 'about' %}selected{% endif %}>About</option>
            <option value="services" {% if selected_page == 'services' %}selected{% endif %}>Services</option>
            <option value="portfolio" {% if selected_page == 'portfolio' %}selected{% endif %}>Portfolio</option>
          </select>
        </div>

        <!-- Caption -->
        <div>
          <label for="caption" class="block text-sm font-semibold mb-2 text-gray-300">Caption</label>
          <input type="text" id="caption" name="caption" 
                 placeholder="Enter caption (optional)"
                 class="w-full bg-[#1c1c1c] text-white border border-white/10 rounded-lg p-3 focus:ring-2 focus:ring-brand/60">
        </div>

        <!-- Hero Checkbox -->
        <div class="flex items-center space-x-3">
          <input type="checkbox" id="is_hero" name="is_hero"
                 class="w-5 h-5 accent-brand border-gray-500 rounded focus:ring-brand">
          <label for="is_hero" class="text-sm font-semibold text-gray-300">Set as Hero Section</label>
        </div>

        <!-- File Upload -->
        <div>
          <label class="block text-sm font-semibold mb-2 text-gray-300">Upload Image/Video</label>
          <input type="file" id="media" name="media" accept="image/*,video/*"
                 class="w-full text-sm bg-[#1c1c1c] border border-white/10 text-gray-300 rounded-lg p-2 focus:ring-2 focus:ring-brand/60">
        </div>
      </div>

      <button type="submit" 
              class="mt-8 bg-brand hover:bg-brand/80 text-white px-8 py-3 rounded-xl font-semibold transition-all duration-200">
        Upload
      </button>
    </form>

    <!-- Filter Media by Page -->
    <div class="mb-6 flex justify-center">
      <select id="filterPage" 
              class="p-3 bg-[#1c1c1c] border border-white/10 text-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-brand/60">
        <option value="all">Show All</option>
        <option value="home">Home</option>
        <option value="about">About</option>
        <option value="services">Services</option>
        <option value="portfolio">Portfolio</option>
      </select>
    </div>

    <!-- Media List -->
    <div id="mediaContainer" class="grid grid-cols-1 md:grid-cols-3 gap-6">
      {% for media in media_list %}
      <div class="bg-[#111111] border border-white/10 rounded-2xl overflow-hidden media-item shadow-md transition-transform hover:scale-[1.02]" data-page="{{ media.page_name }}">
        {% if media.media_type == 'video' %}
        <video controls class="w-full h-56 object-cover bg-black">
          <source src="{{ url_for('static', filename='uploads/' + media.filename) }}" type="video/mp4">
        </video>
        {% else %}
        <img src="{{ url_for('static', filename='uploads/' + media.filename) }}" 
             class="w-full h-56 object-cover" alt="{{ media.caption }}">
        {% endif %}
        <div class="p-4 text-left">
          <p class="text-sm text-gray-400">{{ media.caption or 'No caption' }}</p>
          <p class="text-xs text-gray-500 mt-1">Page: <strong class="capitalize text-gray-300">{{ media.page_name }}</strong></p>
          {% if media.is_hero %}
          <p class="text-xs text-brand font-semibold mt-1">ðŸŒŸ Hero Section</p>
          {% endif %}
          <form action="{{ url_for('delete_media', media_id=media.id) }}" method="POST" class="mt-3">
            <button type="submit" class="text-red-500 hover:text-red-400 text-sm font-medium transition">Delete</button>
          </form>
        </div>
      </div>
      {% endfor %}
    </div>
  </div>
</section>

<!-- Script: Remember selection + filter -->
<script>
  document.addEventListener("DOMContentLoaded", () => {
    const selectPage = document.getElementById("page_name");
    const filterPage = document.getElementById("filterPage");
    const mediaItems = document.querySelectorAll(".media-item");

    // Keep last selected page
    const savedPage = localStorage.getItem("selectedPage") || "home";
    selectPage.value = savedPage;

    selectPage.addEventListener("change", () => {
      localStorage.setItem("selectedPage", selectPage.value);
    });

    // Filter media by page
    filterPage.addEventListener("change", () => {
      const filterValue = filterPage.value;
      mediaItems.forEach(item => {
        item.style.display = (filterValue === "all" || item.dataset.page === filterValue)
          ? "block"
          : "none";
      });
    });
  });
</script>

{% endblock %}
